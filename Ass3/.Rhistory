length(Clothing$var)
for(i in 1:length(Clothing$var)){
if(Clothing$sex[i]=="male"){
Clothing$var[i] = varmale
}
else{
Clothing$var[i] = varfemale
}
}
View(Clothing)
summary(Clothing$var)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~Clothing$var)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
logLik(model3)
anova(model3)
summary(model3)
plot(model3)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
nlminb(rep(0,803),optimize))
nlminb(rep(0,803),optimize)
opt = nlminb(rep(0,803),optimize)
View(opt)
opt[["par"]]
View(opt)
vf1 <- varFixed(~Clothing$var)
vf1
#
varr=Clothing$var
vf1 <- varFixed(~varr)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~vf1)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML")#,weights = ~var)
-logLik(model3)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
clothing$var <- vars
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
opt = nlminb(rep(0,803),optimize)
View(opt)
opt[["par"]]
warnings()
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
clothing$var <- list(vars)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
opt = nlminb(rep(0,803),optimize)
warnings()
zeross=rep(0,803)
Clothing$new = zeross
View(Clothing)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
Clothing$var <- list(vars)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
opt = nlminb(rep(0,803),optimize)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
Clothing$var <- vars
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
opt = nlminb(rep(0,803),optimize)
# add weights as their is dispersion in the end of the residuals
optimize = function(vars){
Clothing$var <- vars
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
-logLik(model3)
}
opt = nlminb(rep(1,803),optimize)
opt = nlminb(varr,optimize)
plot(fit.exp)
Clothing$var<-Clothing$clo
for(i in 1:length(Clothing$var)){
Clothing$var[i]=var(Clothing$clo[Clothing$subjId==Clothing$subjId[i]])
}
View(Clothing)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
logLik(model3)
anova(model3)
summary(model3)
plot(model3)
for(i in 1:length(Clothing$var)){
if(Clothing$sex[i]=="male"){
Clothing$var[i] = var(Clothing$clo[Clothing$day==Clothing$day[i] & Clothing$sex=="male"])
}
else{
Clothing$var[i] = var(Clothing$clo[Clothing$day==Clothing$day[i] & Clothing$sex=="female"])
}
}
View(Clothing)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
logLik(model3)
anova(model3)
summary(model3)
plot(model3)
Clothing$var<-Clothing$clo
for(i in 1:length(Clothing$var)){
Clothing$var[i]=var(Clothing$clo[Clothing$subjId==Clothing$subjId[i]])
}
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
logLik(model3)
anova(model3)
summary(model3)
plot(model3)
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML")#,weights = ~var)
logLik(model3)
anova(model3)
summary(model3)
plot(model3)
model5 <- lme(clo ~ tInOp*sex+ tOut, random= ~ 1|subjId/day, data=Clothing, method="REML",weights=~var)
logLik(model5)
anova(model5)
summary(model5)
plot(model5)
for(i in 1:length(Clothing$var)){
Clothing$var[i]=var(Clothing$clo[Clothing$subjId==Clothing$subjId[i]])
}
optimize = function(vars){
Clothing$var <- vars
########################### Insert model here
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~var)
###########################
-logLik(model3)
}
varr=Clothing$var
opt = optim(varr,optimize)
View(opt)
opt = optim(varr,optimize,method = CG"")
opt = optim(varr,optimize,method = "CG")
########################### Insert model here
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~1/var)
View(opt)
means=aggregate(clo ~ subjId, data=clo,FUN=mean)
View(means)
View(Clothing)
means=aggregate(var ~ subjId, data=clo,FUN=mean)
means=aggregate(Clothing ~ subjId, data=clo,FUN=mean)
means=aggregate(clo ~ subjId, data=clo,FUN=mean)
means=aggregate(vars ~ subjId, data=clo,FUN=mean)
means=aggregate(var ~ subjId, data=clo,FUN=mean)
Clothing = read.csv('clothingFullAss03.csv')
Clothing$var<-Clothing$clo
for(i in 1:length(Clothing$var)){
Clothing$var[i]=var(Clothing$clo[Clothing$subjId==Clothing$subjId[i]])
}
means=aggregate(var ~ subjId, data=clo,FUN=mean)
means=aggregate(var ~ subjId, data=Clothing,FUN=mean)
View(means)
View(Clothing)
View(means)
varr=means$var
optimize = function(vars){
for(i in 1:length(Clothing$var)){
Clothing$var[i]=means$var[means$subjId==Clothing$subjId]
}
########################### Insert model here
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~1/var)
###########################
-logLik(model3)
}
varr=means$var
opt = optim(varr,optimize,method = "CG")
View(opt)
opt = optim(varr,optimize)
warnings()
optimize = function(vars){
for(i in 1:length(Clothing$var)){
Clothing$var[i]=means$var[means$subjId==Clothing$subjId[i]]
}
########################### Insert model here
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~1/var)
###########################
-logLik(model3)
}
varr=means$var
opt = optim(varr,optimize)
View(opt)
optimize = function(vars){
for(i in 1:length(Clothing$var)){
Clothing$var[i]=means$var[means$subjId==Clothing$subjId[i]]
}
print(Clothing$var)
########################### Insert model here
model3 <- lme(clo ~ tOut*sex+tOut*day, random= ~ 1|subjId, data=Clothing, method="REML",weights = ~1/var)
###########################
-logLik(model3)
}
varr=means$var
opt = optim(varr,optimize)
## Advanced Data Analysis and Statistical Modelling
## Assignment 3
## part 1
require(plotrix)
library(nlme)
library(car)
#setwd('/Users/idabukhvillesen/Dropbox/8 SEMESTER/Adv. Data Ana. & Stat. Mod./Assignments/Assignment 3')
#setwd("~/Documents/GitHub/Adv-data-analysis-projects/Ass3") #Helena directory
clothing <- read.table(file = 'clothingFullAss03.csv', sep = ",",header=TRUE)
# Data presentation ----
# Plot colors
colors=clothing$sex
colors[clothing$sex=='female']="red"
colors[clothing$sex=='male']="blue"
no.persons <- max(clothing$subjId)
persons <- c(0:no.persons)
clo.mean <- rep(0,no.persons)
clo.std <- rep(0,no.persons)
clo.sex <- rep(0,no.persons)
for(i in 0:no.persons){
clo.mean[i+1] <- mean(clothing$clo[clothing$subjId==i])
clo.std[i+1] <- sd(clothing$clo[clothing$subjId==i])
if (clothing$sex[clothing$subjId==i] == 'female'){
clo.sex[i+1] <- 1
}
}
plotCI(persons[clo.sex==1],clo.mean[clo.sex==1],uiw=clo.std[clo.sex==1],liw= clo.std[clo.sex==1], col="lightpink1",xlab="Subject ID",ylab="Clothing",main="Average clothing for the Subjects")
plotCI(persons[clo.sex==0],clo.mean[clo.sex==0],uiw=clo.std[clo.sex==0],liw= clo.std[clo.sex==0], col="lightskyblue1",add=TRUE)
legend("topright", legend = c("Female","Male"),col=c("lightpink1","cadetblue1"), pch=c(1,1),cex=0.85)
# Fit mixed effects models that use subjId as a random effect ----
lme.1 <- lme(clo ~ factor(sex), random = ~1|subjId, data=clothing)
summary(lme.1)
Anova(lme.1, type='III')
plot(lme.1)
lme.2 <- lme(clo ~ factor(sex) + factor(day), random = ~1|subjId, data=clothing)
summary(lme.2)
Anova(lme.2, type='III')
plot(lme.2)
lme.3 <- lme(clo ~ factor(sex) + factor(day) + time, random = ~1|subjId, data=clothing)
summary(lme.3)
Anova(lme.3, type='III')
plot(lme.3)
anova(lme.2,lme.3)
lme.4 <- lme(clo ~ factor(sex) + factor(day) + time + tOut, random = ~1|subjId, data=clothing)
summary(lme.4)
Anova(lme.4, type='III')
plot(lme.4)
lme.5 <- lme(clo ~ factor(sex) + factor(day) + time + tOut + tInOp, random = ~1|subjId, data=clothing)
summary(lme.5)
Anova(lme.5, type='III')
plot(lme.5)
lme.6 <- lme(clo ~ factor(sex) + factor(day) + time + tOut*factor(day) + tInOp, random = ~1|subjId, data=clothing)
summary(lme.6)
Anova(lme.6, type='III')
plot(lme.6)
lme.7 <- lme(clo ~ factor(sex) + factor(day) + time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId, data=clothing)
summary(lme.7)
Anova(lme.7, type='III')
plot(lme.7)
lme.8 <- lme(clo ~  time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId, data=clothing)
summary(lme.8)
Anova(lme.8, type='III')
plot(lme.8)
# it can be seen that weights should be added.
# Add Weights
clothing$var<-clothing$clo
for(i in 1:length(clothing$var)){
clothing$var[i]=var(clothing$clo[clothing$subjId==clothing$subjId[i]])
}
# FINAL MODEL
lme.9 <- lme(clo ~    time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId,
weights = ~var, data=clothing)
summary(lme.9)
Anova(lme.9,type ='III')
plot(lme.9)
# the residuals still look very strange - quite varying +-2.
# Fit mixed effects models that use subjId and day as a random effect ----
lme.10 <- lme(clo ~ time+tOut+ tInOp + factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.10)
Anova(lme.10, type = 'III')
plot(lme.10)
# remove tInOp
lme.11 <- lme(clo ~time+ tOut + factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.11)
Anova(lme.11, type = 'III')
plot(lme.11)
# remove time
lme.11 <- lme(clo ~ tOut+factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.11)
Anova(lme.11, type = 'III')
plot(lme.11)
#FINAL MODEL
lme.12 <- lme(clo ~ factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.12)
Anova(lme.12, type = 'III')
plot(lme.12)
# Fit mixed effects models that use autocorrelation ----
## by using subDay, we remove the factor day and subjID in this way
fit.exp<- lme(clo ~ tInOp+factor(sex)+ tOut,random=~1|subDay,
correlation=corExp(form=~1|subDay),
data=clothing,
method="ML")
logLik(fit.exp)
plot(Variogram(fit.exp), main='Exp')
## Advanced Data Analysis and Statistical Modelling
## Assignment 3
## part 1
require(plotrix)
library(nlme)
library(car)
#setwd('/Users/idabukhvillesen/Dropbox/8 SEMESTER/Adv. Data Ana. & Stat. Mod./Assignments/Assignment 3')
#setwd("~/Documents/GitHub/Adv-data-analysis-projects/Ass3") #Helena directory
clothing <- read.table(file = 'clothingFullAss03.csv', sep = ",",header=TRUE)
# Data presentation ----
# Plot colors
colors=clothing$sex
colors[clothing$sex=='female']="red"
colors[clothing$sex=='male']="blue"
no.persons <- max(clothing$subjId)
persons <- c(0:no.persons)
clo.mean <- rep(0,no.persons)
clo.std <- rep(0,no.persons)
clo.sex <- rep(0,no.persons)
for(i in 0:no.persons){
clo.mean[i+1] <- mean(clothing$clo[clothing$subjId==i])
clo.std[i+1] <- sd(clothing$clo[clothing$subjId==i])
if (clothing$sex[clothing$subjId==i] == 'female'){
clo.sex[i+1] <- 1
}
}
plotCI(persons[clo.sex==1],clo.mean[clo.sex==1],uiw=clo.std[clo.sex==1],liw= clo.std[clo.sex==1], col="lightpink1",xlab="Subject ID",ylab="Clothing",main="Average clothing for the Subjects")
plotCI(persons[clo.sex==0],clo.mean[clo.sex==0],uiw=clo.std[clo.sex==0],liw= clo.std[clo.sex==0], col="lightskyblue1",add=TRUE)
legend("topright", legend = c("Female","Male"),col=c("lightpink1","cadetblue1"), pch=c(1,1),cex=0.85)
# Fit mixed effects models that use subjId as a random effect ----
lme.1 <- lme(clo ~ factor(sex), random = ~1|subjId, data=clothing)
summary(lme.1)
Anova(lme.1, type='III')
plot(lme.1)
lme.2 <- lme(clo ~ factor(sex) + factor(day), random = ~1|subjId, data=clothing)
summary(lme.2)
Anova(lme.2, type='III')
plot(lme.2)
lme.3 <- lme(clo ~ factor(sex) + factor(day) + time, random = ~1|subjId, data=clothing)
summary(lme.3)
Anova(lme.3, type='III')
plot(lme.3)
anova(lme.2,lme.3)
lme.4 <- lme(clo ~ factor(sex) + factor(day) + time + tOut, random = ~1|subjId, data=clothing)
summary(lme.4)
Anova(lme.4, type='III')
plot(lme.4)
lme.5 <- lme(clo ~ factor(sex) + factor(day) + time + tOut + tInOp, random = ~1|subjId, data=clothing)
summary(lme.5)
Anova(lme.5, type='III')
plot(lme.5)
lme.6 <- lme(clo ~ factor(sex) + factor(day) + time + tOut*factor(day) + tInOp, random = ~1|subjId, data=clothing)
summary(lme.6)
Anova(lme.6, type='III')
plot(lme.6)
lme.7 <- lme(clo ~ factor(sex) + factor(day) + time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId, data=clothing)
summary(lme.7)
Anova(lme.7, type='III')
plot(lme.7)
lme.8 <- lme(clo ~  time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId, data=clothing)
summary(lme.8)
Anova(lme.8, type='III')
plot(lme.8)
# it can be seen that weights should be added.
# Add Weights
clothing$var<-clothing$clo
for(i in 1:length(clothing$var)){
clothing$var[i]=var(clothing$clo[clothing$subjId==clothing$subjId[i]])
}
# FINAL MODEL
lme.9 <- lme(clo ~    time + tOut*factor(day) + tInOp*factor(sex), random = ~1|subjId,
weights = ~var, data=clothing)
summary(lme.9)
Anova(lme.9,type ='III')
plot(lme.9)
# the residuals still look very strange - quite varying +-2.
# Fit mixed effects models that use subjId and day as a random effect ----
lme.10 <- lme(clo ~ time+tOut+ tInOp + factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.10)
Anova(lme.10, type = 'III')
plot(lme.10)
# remove tInOp
lme.11 <- lme(clo ~time+ tOut + factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.11)
Anova(lme.11, type = 'III')
plot(lme.11)
# remove time
lme.11 <- lme(clo ~ tOut+factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.11)
Anova(lme.11, type = 'III')
plot(lme.11)
#FINAL MODEL
lme.12 <- lme(clo ~ factor(sex), random = ~ 1|subjId/day,weights = ~var,
data=clothing)
summary(lme.12)
Anova(lme.12, type = 'III')
plot(lme.12)
# Fit mixed effects models that use autocorrelation ----
## by using subDay, we remove the factor day and subjID in this way
fit.exp<- lme(clo ~ tInOp+factor(sex)+ tOut,random=~1|subDay,
correlation=corExp(form=~1|subDay),
data=clothing,
method="ML")
logLik(fit.exp)
plot(Variogram(fit.exp), main='Exp')
plot(lme.8)
plot(lme.9)
(lme.8)
plot(lme.8)
plot(lme.9)
ll look very strange - quite varying +-2.
library('gridExtra')
p1 <- plot(lme.8)
p2 <- plot(lme.9)
grid.arrange(p1,p2)
grid.arrange(p1,p2,c(1,2))
grid.arrange(p1,p2,1,2)
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,xrange=c(-3,3))
p2 <- plot(lme.9)
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,xlim=c(-3,3))
p2 <- plot(lme.9)
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3))
p2 <- plot(lme.9)
grid.arrange(p1,p2,ncol=2)
p2 <- plot(lme.9,ylim=c(-3,3))
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3),xlim = c(0,1))
p2 <- plot(lme.9,ylim=c(-3,3),xlim = c(0,1))
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3),xlim = c(0,1),main = "Non weighted")
p2 <- plot(lme.9,ylim=c(-3,3),xlim = c(0,1),main = "Weighted")
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3.2),xlim = c(0,1),main = "Non weighted")
p2 <- plot(lme.9,ylim=c(-3,3.2),xlim = c(0,1),main = "Weighted")
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3.5),xlim = c(0,1),main = "Non weighted")
p2 <- plot(lme.9,ylim=c(-3,3.2),xlim = c(0,1),main = "Weighted")
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,4),xlim = c(0,1),main = "Non weighted")
p2 <- plot(lme.9,ylim=c(-3,3.5),xlim = c(0,1),main = "Weighted")
grid.arrange(p1,p2,ncol=2)
p1 <- plot(lme.8,ylim=c(-3,3.5),xlim = c(0,1),main = "Non weighted")
p2 <- plot(lme.9,ylim=c(-3,3.5),xlim = c(0,1),main = "Weighted")
grid.arrange(p1,p2,ncol=2)
# DENSITY PLOT OF CLOTHING
clothing = Clothing$clo
# Density plot of Clo:
f<-function(x){dnorm(x,mean=mean(clothing,na.rm=T),
sd=sd(clothing,na.rm=T))}
hist(clothing,xlab='Clothing',probability=T)
curve(f,0,1,lwd=3,col="red",add=T)
rm(f)
Clothing = read.csv('clothingFullAss03.csv')
par(mfrow=c(1,2))
with(Clothing, {
interaction.plot(subjId, day, clo, legend=FALSE,
bty="n", col=2:11, xtick = TRUE)
interaction.plot(sex, day, clo, legend=FALSE,
bty="n", col=2:11, xtick = TRUE)})
par(mfrow=c(1,1))
par(mfrow=c(1,3))
boxplot(Clothing$clo ~Clothing$sex, col=2:6, xlab = "Sex", ylab = "Clothing Level")
boxplot(Clothing$clo ~Clothing$day, col=2:6, xlab = "Day", ylab = "Clothing Level")
boxplot(Clothing$clo ~Clothing$subjId, col=2:6, xlab = "SubjId", ylab = "Clothing Level")
par(mfrow=c(1,2))
boxplot(Clothing$tInOp ~Clothing$day, col=2:6, xlab = "Day", ylab = "Temp. Indoor")
boxplot(Clothing$tOut ~Clothing$day, col=2:6, xlab = "Day", ylab = "Temp. Outdoor")
par(mfrow=c(1,1))
# DENSITY PLOT OF CLOTHING
clothing = Clothing$clo
# Density plot of Clo:
f<-function(x){dnorm(x,mean=mean(clothing,na.rm=T),
sd=sd(clothing,na.rm=T))}
hist(clothing,xlab='Clothing',probability=T)
curve(f,0,1,lwd=3,col="red",add=T)
hist(clothing,xlab='Clothing',probability=T,xlim = x(0,1))
# Density plot of Clo:
f<-function(x){dnorm(x,mean=mean(clothing,na.rm=T),
sd=sd(clothing,na.rm=T))}
hist(clothing,xlab='Clothing',probability=T,xlim = c(0,1))
curve(f,0,1,lwd=3,col="red",add=T)
qqnorm(lme.9)
qqline(lme.9)
qqline(lme.9$residuals)
qqnorm(lme.9$residuals)
qqline(lme.9$residuals)
qqnorm(lme.8$residuals)
qqline(lme.8$residuals)
par(mfrow=c(1,2))
qqnorm(lme.8$residuals)
qqline(lme.8$residuals)
qqnorm(lme.9$residuals)
qqline(lme.9$residuals)
